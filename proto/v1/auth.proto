syntax = "proto3";

package auth.v1;
option go_package = "github.com/gaiaos-io/auth-service/proto/v1;authpb";

import "google/protobuf/empty.proto";

service AuthService {
  // Email-Based Authentication
  rpc EmailRegister(EmailRegisterRequest) returns (AuthResponse);
  rpc EmailLogin(EmailLoginRequest) returns (AuthResponse);
  
  // OAuth-Based Authentication
  rpc StartOAuth(StartOAuthRequest) returns (StartOAuthResponse);
  rpc FinishOAuth(FinishOAuthRequest) returns (AuthResponse);
  rpc UnlinkOAuth(UnlinkOAuthRequest) returns (google.protobuf.Empty);

  // Token & Session Management
  rpc RefreshToken(RefreshTokenRequest) returns (AuthResponse);  
  rpc Logout(LogoutRequest) returns (google.protobuf.Empty);

  // User Management
  rpc UpdateContactEmail(UpdateContactEmailRequest) returns (google.protobuf.Empty);
  rpc VerifyContactEmail(VerifyContactEmailRequest) returns (google.protobuf.Empty);
  rpc GetMe(GetMeRequest) returns (UserResponse);
}

enum OAuthProvider {
  OAUTH_PROVIDER_UNSPECIFIED = 0;
  GOOGLE = 1;
  GITHUB = 2;
}

enum OAuthIntent {
  OAUTH_INTENT_UNSPECIFIED = 0;
  LOGIN = 1;
  LINK = 2;
}

message EmailRegisterRequest {
  string email = 1;
  string password = 2;
}

message EmailLoginRequest {
  string email = 1;
  string password = 2;
}

message UpdateContactEmailRequest {
  string email = 1;
}

message VerifyContactEmailRequest {
  string token = 1;
}

message StartOAuthRequest {
  OAuthProvider provider = 1;
  OAuthIntent intent = 2;
  string redirect_url = 3;
}

message FinishOAuthRequest {
  OAuthProvider provider = 1;
  OAuthIntent intent = 2;
  string code = 3;
  string state = 4;
}

message UnlinkOAuthRequest {
  string provider = 1;
}

message RefreshTokenRequest {
  string refresh_token = 1;
}

message LogoutRequest {}

message GetMeRequest {}

message UserResponse {
  string id = 1;
  string email = 2;
  bool email_verified = 3;
}

message AuthResponse {
  string access_token = 1;
  string refresh_token = 2;
  UserResponse user = 3;
}

message StartOAuthResponse {
  string authorization_url = 1;
}
